<section data-ng-controller="EditLoopController" data-ng-init="findOne()">

    <div class="loopHeader">
        <label class="loopName">{{loop.name}}</label>

        <div class="loopControls">
            <button class="btn menuBtn" data-ng-click="updateState()">Save</button>
            <button class="btn menuBtn" data-ng-click="getState()">Revert</button>
            <button class="btn menuBtn" data-ng-click="showSettings = !showSettings">Settings </button>
            <button class="btn menuBtn" data-ng-click="remove();"><span class="glyphicon glyphicon-trash"></span>
            </button>
            <div ng-show="showSettings"class="settings">
                    <h1>Settings</h1>
                        <div ng-show="isPublic()">
                            <span> This loop is currently private. </span>
                            <a class="btn btn-default" data-ng-click="makePublic()">Make Public</a>
                        </div>
                        <div ng-show="isPrivate()">
                            <span> This loop is currently public to everyone </span>
                            <a class="btn btn-default" data-ng-click="makePrivate()">Make Private</a>
                        </div>
                        <div data-ng-repeat="User in information"> 
                            <div ng-hide="checkPerson($index)">
                                <span> {{information[$index].firstName}} has access to this loop. </span>
                            </div>
                            <div ng-show="checkPerson($index)">
                                <span ng-hide="show" data-ng-bind="information[$index].firstName"></span>
                                <a class="btn btn-default" data-ng-click="addPerson($index); show=true" ng-hide="show">Add</a>
                            </div>
                        </div>
                    </div>
        </div>


    </div>
    <div class="loopUsers">
        <label>Active User(s): </label>
        <label>{{loop.user.username}}</label>
    </div>

    <section data-ng-controller="PlaybackController">
    <!--<button class="btn menuBtn" data-ng-click="revertState()">Revert</button>-->
    <div class = "sequencer">
        <div class="sequencerMainControls">
            <button class="btn btn-sm glyphicon" ng-click="play()">
                <span ng-class="{'glyphicon-play':!isPlaying(),'glyphicon-pause':isPlaying()}"></span>
            </button>

            <button class="btn btn-sm glyphicon" ng-click="stop()"><span class="glyphicon-stop"></span> </button>

            <button class="btn btn-sm " ng-click="clear()">Clear</button>

            <label style="width: 30px;"></label>

            <div class="btn-group" ng-click="bpbChange()">
                <button class="btn btn-sm glyphicon" ng-click="decrBeatsPerBar()"><span class="glyphicon-minus"></span> </button>
                <button class="btn btn-sm glyphicon" disabled>{{loop_state.beats_per_bar}} beats per bar</button>
                <button class="btn btn-sm glyphicon" ng-click="incrBeatsPerBar()"><span class="glyphicon-plus"></span> </button>
            </div>

            <div class="btn-group" ng-click="barsChange()">
                <button class="btn btn-sm glyphicon" ng-click="decrNumBar()"><span class="glyphicon-minus"></span> </button>
                <button class="btn btn-sm glyphicon" disabled>{{loop_state.num_bars}} bars</button>
                <button class="btn btn-sm glyphicon" ng-click="incrNumBar()"><span class="glyphicon-plus"></span> </button>
            </div>

            <div class="btn-group bpm-ctrl">
                <button class="btn btn-sm glyphicon" ng-click="halfBPM()"><span>/2</span></button>
                <button class="btn btn-sm glyphicon" ng-click="decrBPM()"><span class="glyphicon-minus"></span> </button>
                <button class="btn btn-sm glyphicon" disabled>{{loop_state.bpm}} BPM</button>
                <button class="btn btn-sm glyphicon" ng-click="incrBPM()"><span class="glyphicon-plus"></span> </button>
                <button class="btn btn-sm glyphicon" ng-click="doubleBPM()"><span>*2</span> </button>
            </div>
        </div>

        <table class="sequencerTable">
            <tr>
                <td></td>

                <td/>
                <td ng-repeat="j in []|range:1:total_beats()" class = "timeBtn td-instrument-time" ng-class="{atTime:at_time(j), notAtTime:!at_time(j)}"/>

                <td/>
            </tr>
            <tr ng-repeat="i in loop_state.instruments">
                <td>
                    <div class="btn-group instrument-select" dropdown>
                        <button type="button" class="btn btn-primary instrumentDropdown" ng-click="playInstrument(i)">{{i.sample.name}}</button>
                        <button type="button" class="btn btn-primary dropdown-toggle instrumentToggle" dropdown-toggle>
                            <span class="caret"></span>
                            <span class="sr-only">Split button!</span>
                        </button>
                        <ul class="dropdown-menu" role="menu">
                            <li ng-repeat="sample in samples" ><a ng-click="changeSample(sample,i)">{{sample.name}}</a></li>
                        </ul>
                    </div>
                </td>

                <td/>

                <td ng-repeat="j in []|range:1:total_beats()" class="customBtn td-instrument-button defaultBtn1" ng-click="sample_click(j-1,i)" 
                ng-class="{inactiveBeat1:beat_group(j,1)&&!pressed(j-1,i), inactiveBeat2:beat_group(j,2)&&!pressed(j-1,i), 
                inactiveBeatPlaying:!pressed(j-1,i)&&playing&&time==(j-1),
                activeBeat:pressed(j-1,i),activeBeatPlaying:pressed(j-1,i)&&playing&&time==(j-1)}"/>


                <td>
                    <button class="btn btn-sm" ng-click="removeInstrument(i)"><span class="glyphicon glyphicon-remove"></span></button>
                </td>
            </tr>
            <tr >
                <td>
                    <button class=" instrument-select btn btn-primary " ng-click="addInstrument()" style="margin-top:20px"><span class="glyphicon glyphicon-plus"></span> Add Instrument</button>
                </td>
                <td/>
            </tr>
        </table>

        <pre class="prettyprint">{{getInstrumentsPretty()}}</pre>
    </div>
    </section>
</section>
